const mock_responses = {
    "jot": [{"sha": "b2f1b95c2fa0c73013cdde5e993f23d826dcc206", "node_id": "C_kwDONAuezNoAKGIyZjFiOTVjMmZhMGM3MzAxM2NkZGU1ZTk5M2YyM2Q4MjZkY2MyMDY", "commit": {"author": {"name": "Jackson Fellows", "email": "jtfellows@icloud.com", "date": "2024-10-09T21:20:15Z"}, "committer": {"name": "Jackson Fellows", "email": "jtfellows@icloud.com", "date": "2024-10-09T21:20:15Z"}, "message": "Change how arrays are \"promoted\" to higher ranks", "tree": {"sha": "4151d37b9c71325780dcc0017d7f331cf7a6a52a", "url": "https://api.github.com/repos/jacksonfellows/jot/git/trees/4151d37b9c71325780dcc0017d7f331cf7a6a52a"}, "url": "https://api.github.com/repos/jacksonfellows/jot/git/commits/b2f1b95c2fa0c73013cdde5e993f23d826dcc206", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/jacksonfellows/jot/commits/b2f1b95c2fa0c73013cdde5e993f23d826dcc206", "html_url": "https://github.com/jacksonfellows/jot/commit/b2f1b95c2fa0c73013cdde5e993f23d826dcc206", "comments_url": "https://api.github.com/repos/jacksonfellows/jot/commits/b2f1b95c2fa0c73013cdde5e993f23d826dcc206/comments", "author": {"login": "jacksonfellows", "id": 7799395, "node_id": "MDQ6VXNlcjc3OTkzOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/7799395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jacksonfellows", "html_url": "https://github.com/jacksonfellows", "followers_url": "https://api.github.com/users/jacksonfellows/followers", "following_url": "https://api.github.com/users/jacksonfellows/following{/other_user}", "gists_url": "https://api.github.com/users/jacksonfellows/gists{/gist_id}", "starred_url": "https://api.github.com/users/jacksonfellows/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jacksonfellows/subscriptions", "organizations_url": "https://api.github.com/users/jacksonfellows/orgs", "repos_url": "https://api.github.com/users/jacksonfellows/repos", "events_url": "https://api.github.com/users/jacksonfellows/events{/privacy}", "received_events_url": "https://api.github.com/users/jacksonfellows/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "committer": {"login": "jacksonfellows", "id": 7799395, "node_id": "MDQ6VXNlcjc3OTkzOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/7799395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jacksonfellows", "html_url": "https://github.com/jacksonfellows", "followers_url": "https://api.github.com/users/jacksonfellows/followers", "following_url": "https://api.github.com/users/jacksonfellows/following{/other_user}", "gists_url": "https://api.github.com/users/jacksonfellows/gists{/gist_id}", "starred_url": "https://api.github.com/users/jacksonfellows/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jacksonfellows/subscriptions", "organizations_url": "https://api.github.com/users/jacksonfellows/orgs", "repos_url": "https://api.github.com/users/jacksonfellows/repos", "events_url": "https://api.github.com/users/jacksonfellows/events{/privacy}", "received_events_url": "https://api.github.com/users/jacksonfellows/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "parents": [{"sha": "1777e113bb45c785d2a209616b2cdb81042fa814", "url": "https://api.github.com/repos/jacksonfellows/jot/commits/1777e113bb45c785d2a209616b2cdb81042fa814", "html_url": "https://github.com/jacksonfellows/jot/commit/1777e113bb45c785d2a209616b2cdb81042fa814"}]}],
    "euler": [{"sha": "187f73872f5554f0fcef2b1bbaf86febf835d52d", "node_id": "C_kwDOAdY6T9oAKDE4N2Y3Mzg3MmY1NTU0ZjBmY2VmMmIxYmJhZjg2ZmViZjgzNWQ1MmQ", "commit": {"author": {"name": "Jackson Fellows", "email": "jtfellows@icloud.com", "date": "2024-08-05T22:44:52Z"}, "committer": {"name": "Jackson Fellows", "email": "jtfellows@icloud.com", "date": "2024-08-05T22:44:52Z"}, "message": "Solve 134!", "tree": {"sha": "fed895356e06d23c54704dad59fda79678174cf8", "url": "https://api.github.com/repos/jacksonfellows/euler/git/trees/fed895356e06d23c54704dad59fda79678174cf8"}, "url": "https://api.github.com/repos/jacksonfellows/euler/git/commits/187f73872f5554f0fcef2b1bbaf86febf835d52d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/jacksonfellows/euler/commits/187f73872f5554f0fcef2b1bbaf86febf835d52d", "html_url": "https://github.com/jacksonfellows/euler/commit/187f73872f5554f0fcef2b1bbaf86febf835d52d", "comments_url": "https://api.github.com/repos/jacksonfellows/euler/commits/187f73872f5554f0fcef2b1bbaf86febf835d52d/comments", "author": {"login": "jacksonfellows", "id": 7799395, "node_id": "MDQ6VXNlcjc3OTkzOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/7799395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jacksonfellows", "html_url": "https://github.com/jacksonfellows", "followers_url": "https://api.github.com/users/jacksonfellows/followers", "following_url": "https://api.github.com/users/jacksonfellows/following{/other_user}", "gists_url": "https://api.github.com/users/jacksonfellows/gists{/gist_id}", "starred_url": "https://api.github.com/users/jacksonfellows/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jacksonfellows/subscriptions", "organizations_url": "https://api.github.com/users/jacksonfellows/orgs", "repos_url": "https://api.github.com/users/jacksonfellows/repos", "events_url": "https://api.github.com/users/jacksonfellows/events{/privacy}", "received_events_url": "https://api.github.com/users/jacksonfellows/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "committer": {"login": "jacksonfellows", "id": 7799395, "node_id": "MDQ6VXNlcjc3OTkzOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/7799395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jacksonfellows", "html_url": "https://github.com/jacksonfellows", "followers_url": "https://api.github.com/users/jacksonfellows/followers", "following_url": "https://api.github.com/users/jacksonfellows/following{/other_user}", "gists_url": "https://api.github.com/users/jacksonfellows/gists{/gist_id}", "starred_url": "https://api.github.com/users/jacksonfellows/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jacksonfellows/subscriptions", "organizations_url": "https://api.github.com/users/jacksonfellows/orgs", "repos_url": "https://api.github.com/users/jacksonfellows/repos", "events_url": "https://api.github.com/users/jacksonfellows/events{/privacy}", "received_events_url": "https://api.github.com/users/jacksonfellows/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "parents": [{"sha": "109b692504066e311465cc2350fe71f9f2759173", "url": "https://api.github.com/repos/jacksonfellows/euler/commits/109b692504066e311465cc2350fe71f9f2759173", "html_url": "https://github.com/jacksonfellows/euler/commit/109b692504066e311465cc2350fe71f9f2759173"}]}],
    "jacksonfellows.github.io": [{"sha": "7d53db65809a4244f65c27f780ae6bb5722e10dd", "node_id": "C_kwDOKJtaXNoAKDdkNTNkYjY1ODA5YTQyNDRmNjVjMjdmNzgwYWU2YmI1NzIyZTEwZGQ", "commit": {"author": {"name": "Jackson Fellows", "email": "jtfellows@icloud.com", "date": "2024-11-03T13:17:00Z"}, "committer": {"name": "Jackson Fellows", "email": "jtfellows@icloud.com", "date": "2024-11-03T13:17:00Z"}, "message": "Switch to lower resolution image for landing page", "tree": {"sha": "efce5a078521e5448156ae3552d2538fc24da49a", "url": "https://api.github.com/repos/jacksonfellows/jacksonfellows.github.io/git/trees/efce5a078521e5448156ae3552d2538fc24da49a"}, "url": "https://api.github.com/repos/jacksonfellows/jacksonfellows.github.io/git/commits/7d53db65809a4244f65c27f780ae6bb5722e10dd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/jacksonfellows/jacksonfellows.github.io/commits/7d53db65809a4244f65c27f780ae6bb5722e10dd", "html_url": "https://github.com/jacksonfellows/jacksonfellows.github.io/commit/7d53db65809a4244f65c27f780ae6bb5722e10dd", "comments_url": "https://api.github.com/repos/jacksonfellows/jacksonfellows.github.io/commits/7d53db65809a4244f65c27f780ae6bb5722e10dd/comments", "author": {"login": "jacksonfellows", "id": 7799395, "node_id": "MDQ6VXNlcjc3OTkzOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/7799395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jacksonfellows", "html_url": "https://github.com/jacksonfellows", "followers_url": "https://api.github.com/users/jacksonfellows/followers", "following_url": "https://api.github.com/users/jacksonfellows/following{/other_user}", "gists_url": "https://api.github.com/users/jacksonfellows/gists{/gist_id}", "starred_url": "https://api.github.com/users/jacksonfellows/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jacksonfellows/subscriptions", "organizations_url": "https://api.github.com/users/jacksonfellows/orgs", "repos_url": "https://api.github.com/users/jacksonfellows/repos", "events_url": "https://api.github.com/users/jacksonfellows/events{/privacy}", "received_events_url": "https://api.github.com/users/jacksonfellows/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "committer": {"login": "jacksonfellows", "id": 7799395, "node_id": "MDQ6VXNlcjc3OTkzOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/7799395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jacksonfellows", "html_url": "https://github.com/jacksonfellows", "followers_url": "https://api.github.com/users/jacksonfellows/followers", "following_url": "https://api.github.com/users/jacksonfellows/following{/other_user}", "gists_url": "https://api.github.com/users/jacksonfellows/gists{/gist_id}", "starred_url": "https://api.github.com/users/jacksonfellows/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jacksonfellows/subscriptions", "organizations_url": "https://api.github.com/users/jacksonfellows/orgs", "repos_url": "https://api.github.com/users/jacksonfellows/repos", "events_url": "https://api.github.com/users/jacksonfellows/events{/privacy}", "received_events_url": "https://api.github.com/users/jacksonfellows/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "parents": [{"sha": "131f88f68e3f8e0d6b705ade0d9882a15723347d", "url": "https://api.github.com/repos/jacksonfellows/jacksonfellows.github.io/commits/131f88f68e3f8e0d6b705ade0d9882a15723347d", "html_url": "https://github.com/jacksonfellows/jacksonfellows.github.io/commit/131f88f68e3f8e0d6b705ade0d9882a15723347d"}]}],
    "sray": [{"sha": "e2e52f5b7a0807db703008a70df3d58e68c9c638", "node_id": "C_kwDOLeF4CdoAKGUyZTUyZjViN2EwODA3ZGI3MDMwMDhhNzBkZjNkNThlNjhjOWM2Mzg", "commit": {"author": {"name": "Jackson Fellows", "email": "jtfellows@icloud.com", "date": "2024-09-15T19:58:27Z"}, "committer": {"name": "Jackson Fellows", "email": "jtfellows@icloud.com", "date": "2024-09-15T19:58:27Z"}, "message": "Add README", "tree": {"sha": "dfdd90df30a5fea0be6d202d5297f12bc53b892d", "url": "https://api.github.com/repos/jacksonfellows/sray/git/trees/dfdd90df30a5fea0be6d202d5297f12bc53b892d"}, "url": "https://api.github.com/repos/jacksonfellows/sray/git/commits/e2e52f5b7a0807db703008a70df3d58e68c9c638", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/jacksonfellows/sray/commits/e2e52f5b7a0807db703008a70df3d58e68c9c638", "html_url": "https://github.com/jacksonfellows/sray/commit/e2e52f5b7a0807db703008a70df3d58e68c9c638", "comments_url": "https://api.github.com/repos/jacksonfellows/sray/commits/e2e52f5b7a0807db703008a70df3d58e68c9c638/comments", "author": {"login": "jacksonfellows", "id": 7799395, "node_id": "MDQ6VXNlcjc3OTkzOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/7799395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jacksonfellows", "html_url": "https://github.com/jacksonfellows", "followers_url": "https://api.github.com/users/jacksonfellows/followers", "following_url": "https://api.github.com/users/jacksonfellows/following{/other_user}", "gists_url": "https://api.github.com/users/jacksonfellows/gists{/gist_id}", "starred_url": "https://api.github.com/users/jacksonfellows/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jacksonfellows/subscriptions", "organizations_url": "https://api.github.com/users/jacksonfellows/orgs", "repos_url": "https://api.github.com/users/jacksonfellows/repos", "events_url": "https://api.github.com/users/jacksonfellows/events{/privacy}", "received_events_url": "https://api.github.com/users/jacksonfellows/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "committer": {"login": "jacksonfellows", "id": 7799395, "node_id": "MDQ6VXNlcjc3OTkzOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/7799395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jacksonfellows", "html_url": "https://github.com/jacksonfellows", "followers_url": "https://api.github.com/users/jacksonfellows/followers", "following_url": "https://api.github.com/users/jacksonfellows/following{/other_user}", "gists_url": "https://api.github.com/users/jacksonfellows/gists{/gist_id}", "starred_url": "https://api.github.com/users/jacksonfellows/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jacksonfellows/subscriptions", "organizations_url": "https://api.github.com/users/jacksonfellows/orgs", "repos_url": "https://api.github.com/users/jacksonfellows/repos", "events_url": "https://api.github.com/users/jacksonfellows/events{/privacy}", "received_events_url": "https://api.github.com/users/jacksonfellows/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "parents": [{"sha": "7396caa0fba2e2bb5d0b38659329d90d63535c82", "url": "https://api.github.com/repos/jacksonfellows/sray/commits/7396caa0fba2e2bb5d0b38659329d90d63535c82", "html_url": "https://github.com/jacksonfellows/sray/commit/7396caa0fba2e2bb5d0b38659329d90d63535c82"}]}],
    "pytorch-seismic-inference": [{"sha": "7fd348b0c93336f2eada75c6633372c08ce84a09", "node_id": "C_kwDOLy0tzNoAKDdmZDM0OGIwYzkzMzM2ZjJlYWRhNzVjNjYzMzM3MmMwOGNlODRhMDk", "commit": {"author": {"name": "Jackson Fellows", "email": "jtfellows@icloud.com", "date": "2024-09-12T12:13:01Z"}, "committer": {"name": "Jackson Fellows", "email": "jtfellows@icloud.com", "date": "2024-09-12T12:13:01Z"}, "message": "Check for file size differences across years", "tree": {"sha": "788ae7edd90a849a7a9563ee5c44bfeb57222d9d", "url": "https://api.github.com/repos/jacksonfellows/pytorch-seismic-inference/git/trees/788ae7edd90a849a7a9563ee5c44bfeb57222d9d"}, "url": "https://api.github.com/repos/jacksonfellows/pytorch-seismic-inference/git/commits/7fd348b0c93336f2eada75c6633372c08ce84a09", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/jacksonfellows/pytorch-seismic-inference/commits/7fd348b0c93336f2eada75c6633372c08ce84a09", "html_url": "https://github.com/jacksonfellows/pytorch-seismic-inference/commit/7fd348b0c93336f2eada75c6633372c08ce84a09", "comments_url": "https://api.github.com/repos/jacksonfellows/pytorch-seismic-inference/commits/7fd348b0c93336f2eada75c6633372c08ce84a09/comments", "author": {"login": "jacksonfellows", "id": 7799395, "node_id": "MDQ6VXNlcjc3OTkzOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/7799395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jacksonfellows", "html_url": "https://github.com/jacksonfellows", "followers_url": "https://api.github.com/users/jacksonfellows/followers", "following_url": "https://api.github.com/users/jacksonfellows/following{/other_user}", "gists_url": "https://api.github.com/users/jacksonfellows/gists{/gist_id}", "starred_url": "https://api.github.com/users/jacksonfellows/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jacksonfellows/subscriptions", "organizations_url": "https://api.github.com/users/jacksonfellows/orgs", "repos_url": "https://api.github.com/users/jacksonfellows/repos", "events_url": "https://api.github.com/users/jacksonfellows/events{/privacy}", "received_events_url": "https://api.github.com/users/jacksonfellows/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "committer": {"login": "jacksonfellows", "id": 7799395, "node_id": "MDQ6VXNlcjc3OTkzOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/7799395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jacksonfellows", "html_url": "https://github.com/jacksonfellows", "followers_url": "https://api.github.com/users/jacksonfellows/followers", "following_url": "https://api.github.com/users/jacksonfellows/following{/other_user}", "gists_url": "https://api.github.com/users/jacksonfellows/gists{/gist_id}", "starred_url": "https://api.github.com/users/jacksonfellows/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jacksonfellows/subscriptions", "organizations_url": "https://api.github.com/users/jacksonfellows/orgs", "repos_url": "https://api.github.com/users/jacksonfellows/repos", "events_url": "https://api.github.com/users/jacksonfellows/events{/privacy}", "received_events_url": "https://api.github.com/users/jacksonfellows/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "parents": [{"sha": "e1bd417d3ea7a72cfd511a611da200bbfdb5b7d2", "url": "https://api.github.com/repos/jacksonfellows/pytorch-seismic-inference/commits/e1bd417d3ea7a72cfd511a611da200bbfdb5b7d2", "html_url": "https://github.com/jacksonfellows/pytorch-seismic-inference/commit/e1bd417d3ea7a72cfd511a611da200bbfdb5b7d2"}]}],
};

const MOCK = true;

async function get_last_commit_info(repo) {
    if (MOCK) return mock_responses[repo][0];
    let response = await fetch(`https://api.github.com/repos/jacksonfellows/${repo}/commits?per_page=1`);
    if (response.ok) {
        let j = await response.json();
        return j[0];
    }
}

function display_header() {
    let d = document.createElement("p");
    d.classList.add("ra");
    d.innerHTML = "Recent GitHub activity";
    document.getElementById("updates").appendChild(d);
}

function display_last_commit(info) {
    let commit_url = info["html_url"];
    let repo = commit_url.split("/")[4];
    let commit_message = info["commit"]["message"].split("\n")[0];
    let commit_timestamp = new Date(info["commit"]["author"]["date"]);
    let commit_timestring = commit_timestamp.toLocaleDateString("en-US", {month: "long", day: "numeric"});
    let d = document.createElement("div");
    d.classList.add("section");
    d.classList.add("ci");
    d.innerHTML = `<a href="${commit_url}" style="text-decoration: none;"><img src="github_logo.svg" id="gh-logo"> <span class="ct">${commit_timestring}</span> <span class="cr">${repo}</span> ${commit_message}</a>`;
    let updates_div = document.getElementById("updates");
    updates_div.appendChild(d);
}

let repos = ["jacksonfellows.github.io", "euler", "jot", "sray", "pytorch-seismic-inference", "seismoslide"];


async function load() {
    let infos = [];
    for (let repo of repos) {
        try {
            let info = await get_last_commit_info(repo);
            infos.push(info);
        } catch (_) {}
    }
    if (infos.length > 0) {
        display_header();
        infos.sort((a, b) => new Date(b["commit"]["author"]["date"]) - new Date(a["commit"]["author"]["date"]));
        for (let info of infos) {
            display_last_commit(info);
        }
    }
}

window.onload = load;
